From e8c0b4425ccda3d907d57949c89bdd5cf40eb40c Mon Sep 17 00:00:00 2001
From: Yevhen Orlov <yevhen.orlov@plvision.eu>
Date: Wed, 19 Jan 2022 21:36:37 +0200
Subject: [PATCH 32/40] Remove vr_abort as part of abort deprecation

JIRA: SWITCHDEV-2533
Signed-off-by: Yevhen Orlov <yevhen.orlov@plvision.eu>
Change-Id: I3f86b6d9ae98b96bde5808e3da8349ad360be71c
---
 drivers/net/ethernet/marvell/prestera/prestera_hw.c    |  9 ---------
 drivers/net/ethernet/marvell/prestera/prestera_hw.h    |  1 -
 .../net/ethernet/marvell/prestera/prestera_router.c    |  1 -
 .../net/ethernet/marvell/prestera/prestera_router_hw.c | 10 ----------
 4 files changed, 21 deletions(-)

diff --git a/drivers/net/ethernet/marvell/prestera/prestera_hw.c b/drivers/net/ethernet/marvell/prestera/prestera_hw.c
index f476e3ed736c..924d47383969 100644
--- a/drivers/net/ethernet/marvell/prestera/prestera_hw.c
+++ b/drivers/net/ethernet/marvell/prestera/prestera_hw.c
@@ -2117,15 +2117,6 @@ int prestera_hw_vr_delete(const struct prestera_switch *sw, u16 vr_id)
 	return fw_send_req(sw, PRESTERA_CMD_TYPE_ROUTER_VR_DELETE, &req);
 }
 
-int prestera_hw_vr_abort(const struct prestera_switch *sw, u16 vr_id)
-{
-	struct prestera_msg_vr_req req = {
-		.vr_id = __cpu_to_le16(vr_id),
-	};
-
-	return fw_send_req(sw, PRESTERA_CMD_TYPE_ROUTER_VR_ABORT, &req);
-}
-
 int prestera_hw_lpm_add(const struct prestera_switch *sw, u16 vr_id,
 			__be32 dst, u32 dst_len, u32 grp_id)
 {
diff --git a/drivers/net/ethernet/marvell/prestera/prestera_hw.h b/drivers/net/ethernet/marvell/prestera/prestera_hw.h
index 3bb50f71afd0..7481183eb791 100644
--- a/drivers/net/ethernet/marvell/prestera/prestera_hw.h
+++ b/drivers/net/ethernet/marvell/prestera/prestera_hw.h
@@ -352,7 +352,6 @@ int prestera_hw_rif_set(const struct prestera_switch *sw, u16 *rif_id,
 /* Virtual Router API */
 int prestera_hw_vr_create(const struct prestera_switch *sw, u16 *vr_id);
 int prestera_hw_vr_delete(const struct prestera_switch *sw, u16 vr_id);
-int prestera_hw_vr_abort(const struct prestera_switch *sw, u16 vr_id);
 
 /* LPM API */
 int prestera_hw_lpm_add(const struct prestera_switch *sw, u16 vr_id,
diff --git a/drivers/net/ethernet/marvell/prestera/prestera_router.c b/drivers/net/ethernet/marvell/prestera/prestera_router.c
index 621dfccf14ca..6ce48e9cb2fc 100644
--- a/drivers/net/ethernet/marvell/prestera/prestera_router.c
+++ b/drivers/net/ethernet/marvell/prestera/prestera_router.c
@@ -2141,7 +2141,6 @@ mvsw_pr_fib_node_util_is_neighbour(struct prestera_fib_node *fib_node)
 
 static void mvsw_pr_router_fib_abort(struct prestera_switch *sw)
 {
-	prestera_vr_util_hw_abort(sw);
 	prestera_fib_node_destroy_ht(sw);
 	mvsw_pr_k_arb_abort(sw);
 }
diff --git a/drivers/net/ethernet/marvell/prestera/prestera_router_hw.c b/drivers/net/ethernet/marvell/prestera/prestera_router_hw.c
index 0dad9929aba4..f197abee0327 100644
--- a/drivers/net/ethernet/marvell/prestera/prestera_router_hw.c
+++ b/drivers/net/ethernet/marvell/prestera/prestera_router_hw.c
@@ -185,16 +185,6 @@ static void prestera_vr_put(struct prestera_switch *sw, struct prestera_vr *vr)
 		__prestera_vr_destroy(sw, vr);
 }
 
-/* TODO: use router_hw_abort. Make this static */
-void prestera_vr_util_hw_abort(struct prestera_switch *sw)
-{
-	struct prestera_vr *vr, *vr_tmp;
-
-	list_for_each_entry_safe(vr, vr_tmp,
-				 &sw->router->vr_list, router_node)
-		prestera_hw_vr_abort(sw, vr->hw_vr_id);
-}
-
 /* make good things. iface is overhead struct... crutch
  * TODO May be it must be union + vr_id should be removed
  */
-- 
2.17.1

